CKEDITOR.dialog.add("codemirrordialog",function(h){var k=CKEDITOR.document.getWindow(),e=k.getViewPaneSize(),l=.7*e.height,e=.9*e.width;h.window||(h.window=k);return{_createCodeMirrorEditor:function(){var a=this.dialog,b=a.getSize(),c=a.getContentElement("main","data").getInputElement().$,c=this.codeMirrorEditor=CodeMirror.fromTextArea(c,{lineNumbers:!0,lineWrapping:!0,mode:"text/html"}),b=.5*b.width-10;c.setSize(b,null);var f=a.getParentEditor();c.setValue(html_beautify(f.getData(!0)));a=a.getContentElement("main",
"preview").getElement();a.setSize("width",b);this._createContentIframe(a).$.contentDocument.body.innerHTML=c.getValue();c.on("change",this._handleCodeMirrorChange.bind(this))},_createContentIframe:function(a){var b=this.dialog,c=b.getParentEditor(),b=b.getContentElement("main").getElement().getAscendant(function(a){return"div"===a.getName()&&"tabpanel"===a.getAttribute("role")}),f=b.getParent(),d=parseInt(f.getComputedStyle("padding-bottom"),10)||0,f=parseInt(f.getComputedStyle("padding-top"),10)||
0,d=b.getSize("height")-(d+f),b=new CKEDITOR.dom.element("iframe");a.append(b);b.setAttributes({"class":"cke_wysiwyg_frame cke_reset",frameborder:0});b.setStyles({height:d+"px",width:"99%"});var g=b.$.contentDocument,e=g.head;a=c.config.contentsCss;Array.isArray(a)?a.forEach(function(a){var b=g.createElement("link");b.setAttribute("href",a);b.setAttribute("rel","stylesheet");e.appendChild(b)}):(d=g.createElement("link"),d.setAttribute("href",a),d.setAttribute("rel","stylesheet"),e.appendChild(d));
a=c.config.contentsLangDirection;d=g.documentElement;d.setAttribute("dir",a);d.setAttribute("lang",c.config.defaultLanguage);c=g.body;c.classList.add("cke_editable");c.classList.add("cke_editable_themed");c.classList.add("cke_contents_"+a);c.setAttribute("contenteditable",!1);c.setAttribute("spellcheck",!1);c.style.background="#fff";return b},_handleCodeMirrorChange:function(){var a=this.codeMirrorEditor.getValue(),b=this.dialog.getContentElement("main","preview").getElement().findOne("iframe");b&&
b.$&&(b.$.contentDocument.body.innerHTML=a)},contents:[{id:"main",elements:[{align:"top",children:[{id:"data",type:"textarea"},{html:'\x3cdiv class\x3d"code_preview"\x3e\x26nbsp;\x3c/div\x3e',id:"preview",type:"html"}],type:"hbox"}]}],height:l,title:h.lang.codemirror.source,width:e,onLoad:function(){this.definition._createCodeMirrorEditor()},onOk:function(){var a=this.definition,b=this.getParentEditor(),a=a.codeMirrorEditor.getValue(),c=b.getData();a!==c&&(b.setData(a),b.setMode("wysiwyg"))},onShow:function(){var a=
this.definition.codeMirrorEditor,b=this.getParentEditor().getData();a&&a.getValue()!==b&&a.setValue(html_beautify(b))}}});